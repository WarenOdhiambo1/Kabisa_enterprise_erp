{% extends 'base.html' %}

{% block title %}Financial Reports - SaasApp{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Financial Reports - {{ month_name }} {{ year }}</h1>
    <form method="get" class="d-flex gap-2">
        <select name="month" class="form-select form-select-sm" style="width: auto;">
            {% for m in "123456789101112" %}
            <option value="{{ m }}" {% if m|add:0 == month %}selected{% endif %}>Month {{ m }}</option>
            {% endfor %}
        </select>
        <input type="number" name="year" class="form-control form-control-sm" style="width: 100px;" value="{{ year }}">
        <button type="submit" class="btn btn-primary btn-sm">View</button>
    </form>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card stat-card" style="border-left: 4px solid var(--success);">
            <div class="stat-value" style="color: var(--success);">${{ total_sales|floatformat:2 }}</div>
            <div class="stat-label"><i class="bi bi-graph-up me-1"></i>Total Sales</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card" style="border-left: 4px solid var(--danger);">
            <div class="stat-value" style="color: var(--danger);">${{ total_expenses|floatformat:2 }}</div>
            <div class="stat-label"><i class="bi bi-cash-stack me-1"></i>Total Expenses</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card" style="border-left: 4px solid var(--primary);">
            <div class="stat-value" style="color: var(--primary);">${{ total_profit|floatformat:2 }}</div>
            <div class="stat-label"><i class="bi bi-wallet2 me-1"></i>Net Profit</div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">Branch Financial Summary</div>
    <div class="card-body p-0">
        <table class="table">
            <thead>
                <tr>
                    <th>Branch</th>
                    <th>Sales</th>
                    <th>Logistics</th>
                    <th>Total Revenue</th>
                    <th>Expenses</th>
                    <th>Profit</th>
                    <th>Margin %</th>
                </tr>
            </thead>
            <tbody>
                {% for report in branch_reports %}
                <tr>
                    <td><a href="{% url 'branch_detail' report.branch.pk %}">{{ report.branch.name }}</a></td>
                    <td class="text-success"><strong>${{ report.sales|floatformat:2 }}</strong></td>
                    <td class="text-danger">${{ report.expenses|floatformat:2 }}</td>
                    <td class="{% if report.profit < 0 %}text-danger{% else %}text-primary{% endif %}">
                        <strong>${{ report.profit|floatformat:2 }}</strong>
                    </td>
                    <td>
                        {% if report.sales > 0 %}
                        {% widthratio report.profit report.sales 100 %}%
                        {% else %}
                        0%
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
